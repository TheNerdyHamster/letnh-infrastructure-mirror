---

# - name: Install firewalld
#   package:
#     name: firewalld
#     state: present

# - name: Install firewalld configuration
#   template:
#     src: firewalld.conf.j2
#     dest: /etc/firewalld/firewalld.conf
#     owner: root
#     group: root
#     mode: 0644
#   notify:
#     - Restart firewalld

# - name: Start and enable firewalld
#   service:
#     name: firewalld
#     enabled: "{{ configure_firewall }}"
#     state: "{{ configure_firewall | ternary('started', 'stopped') }}"

# - name: Disable default dhcpv6-client rule
#   firewalld:
#     service: dhcpv6-client
#     state: disabled
#     immediate: true
#   when: configure_firewall

- name: Configure sysctl
  sysctl:
    name: '{{ item.name }}'
    value: '{{ item.value }}'
    state: present
  with_items:
    # DROP ICMP echo-requests sent to broadcast or multicast
    - { name: net.ipv4.icmp_echo_ignore_broadcasts, value: 1 } 
    # Drop source routed packets
    - { name: net.ipv4.conf.all.accept_source_route, value: 0 }
    # Enable TCP SYN cookie protection from SYN floods
    - { name: net.ipv4.tcp_syncookies, value: 1 }
    # Don't accept ICMP redirect messages
    - { name: net.ipv4.conf.all.accept_redirects, value: 0 }
    # Don't send ICMP redirect messages
    - { name: net.ipv4.conf.all.send_redirects, value: 0 }
    # Enable source address spoofing protection
    - { name: net.ipv4.conf.all.rp_filter, value: 1 }
    # Log packets with impossible source addresses
    - { name: net.ipv4.conf.all.log_martians, value: 1 }
