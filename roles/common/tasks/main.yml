---

- name: configure hostname
  hostname:
    name: "{{ inventory_hostname }}"

- name: update package cache
  apt:
    update_cache: yes

- name: install auditd
  apt:
    name: 
      - auditd
      - audispd-plugins

- name: enable and start auditd
  service:
    name: auditd
    enabled: yes
    state: started

- name: enable and start systemd-timesyncd
  service:
    name: systemd-timesyncd
    enabled: yes
    state: started

- name: generate ssh key for root user
  openssh_keypair:
    path: "/root/.ssh/id_rsa"
    type: rsa
    size: 4096
    state: present
    force: no

- name: configure journald
  template:
    src: "{{ item }}.j2"
    dest: /etc/systemd/{{ item }}
    owner: root
    group: root
    mode: 0644
  with_items:
    - journald.conf
  notify:
    - restart journald

- name: install syslog-ng
  apt:
    name: syslog-ng
    state: present

- name: configure syslog-ng
  template:
    src: "{{ item.name }}.j2"
    dest: "{{ item.path }}{{ item.name }}"
    owner: root
    group: root
    mode: "{{ item.mode }}"
  with_items:
    - { name: "syslog-ng.conf", path: "/etc/syslog-ng/", mode: '0600' }
    - { name: "syslog-ng@default", path: "/etc/default/", mode: '0644' }
  notify:
    - restart syslog-ng

- name: enable and start syslog-ng
  service:
    name: syslog-ng
    enabled: yes
    state: started



